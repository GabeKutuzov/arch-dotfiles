# (c) Copyright 2011-2018, The Rockefeller University *11225* 
# $Id: maklux64 37 2018-08-15 19:53:33Z  $
########################################################################
#          Make file for old ROCKS metafile plotting library           #
#                     Version for 64-bit PC Linux                      #
#                                                                      #
#  This is the sub-makefile called from the top-level makefile         #
#  to make the serial version of the library.                          #
#                                                                      #
# V2A, 08/26/11, GNR - Derived from 32-bit makefile                    #
# V3A, 07/21/16, GNR - Update for MPI version                          #
# ==>, 08/14/16, GNR - Last mod before committing to svn repository    #
# Rev, 05/02/17, GNR - Add rkgtest                                     #
# Rev, 05/27/18, GNR - Add col2gr                                      #
########################################################################

# Directory where all this stuff is stored
LCLHOME ?= $(HOME)
# Define directory where include files are stored
INC := $(LCLHOME)/include
# Define directory where object and dependency files are stored
DIR := pclux64
# Define directory where result plot library is stored
LIB := $(LCLHOME)/lib/pclux64
# Name to be given to output library
LN  := serplot

# Object files to be included in PLOT library

OBJFILES = \
mfalign \
mfbchk  \
mfbitpk \
mfckerr \
mfflush \
mfhead  \
mfstate \
mfsynch \
newpltw \
newwin  \
a2mf    \
cs2mf   \
g2mf    \
h2mf    \
k2mf    \
r2mf    \
s2mf    \
w2mf    \
x2mf    \
xp2mf   \
y2mf    \
yp2mf   \
arc \
arc2 \
arrow \
#axlin \
#axlog \
#axpol \
#bitmap \
#bitmaps \
chgwin \
circle \
clswin \
color \
#ctscol \
#ctsyn \
ellips \
#endplt \
#factor \
#finplot \
#finwin \
#font \
#frame \
#frmdbm \
#frmdef \
#frmdel \
#frminq \
#frmplt \
#gmode \
#gobjid \
#gscale \
line \
#mfhead \
#mfprtf \
#newplt \
#nombc \
#nomber \
#numbc \
#number \
#pencol \
#penset \
#pentyp \
plot \
#plotvers \
#polygn \
#polyln \
rect \
retrace \
square \
#simbc \
#simbol \
#symbc \
#symbol \
where

MFFILES = \
mfbchk \
mfckerr \
mfstate \
mfsynch \
#mfwrite \
setmf

MF0FILES = \
mfclose \
mfcreate \
mfstart \
rkgifin \
rkginit \
setmf \
setmovie
#mfbchk \

.SUFFIXES:
.SUFFIXES: .d .c .s .o

OBJ := $(OBJFILES) $(MFFILES) $(MF0FILES)
CC := gcc
CFLAGS := -g
CFLGS := $(CFLAGS) -Wcomment -Wformat -Wimplicit -Wsequence-point \
   -Wreturn-type -Wunused-variable -Wunused-label -Wuninitialized \
   -Wundef -Wcast-qual -Wunreachable-code -m64
SVNV := $(shell gnrversn)
DEFS := PCLUX64 _ISOC99_SOURCE USE_MPI SVNVRS=$(patsubst %,'"%"',$(SVNV))

# Targets
.PHONY : SERPLOT

# Generate dependencies via gcc mechanism
$(DIR)/%.d:	%.c
	$(SHELL) -ec '$(CC) -MM $(DEFS:%=-D%) $(\CFLGS) $(INC:%=-I%) $< \
	| cat dirfile - > $@'

# Compile for Linux
$(DIR)/%.o: %.c $(DIR)/%.d maklux64
	$(CC) $(CFLGS) $(DEFS:%=-D%) $(INC:%=-I%) -c $<
	mv $*.o $(DIR)

# Make SERPLOT
SERPLOT:	$(OBJ:%=$(DIR)/%.o)
	ar r lib$(LN).a $(OBJ:%=$(DIR)/%.o)
	ranlib lib$(LN).a
	mv lib$(LN).a $(LIB)

# Make Rkgtest
Rkgtest:	$(DIR)/rkgtest.o $(LIB)/lib$(LN).a \
		$(LIB)/libimgtools.a $(LIB)/libsermpit.a $(LIB)/libcrk.a
	$(CC) $(CFLGS) -o Rkgtest $(DIR)/rkgtest.o -L$(LIB) \
		-l$(LN) -limgtools -lsermpit -lcrk -lpng -lm

clean:
	rm -f $(DIR)/*.[od] $(LIB)/lib$(LN).a

include $(OBJ:%=$(DIR)/%.d)